<title>Diskus - {{thread.title}}</title>

<a href="/forums/{{thread.forum_id}}"><strong>← Takaisin aiheeseen</strong></a><br>
<h1>{{thread.title}}</h1>
<hr>
{% for message in messages %}
    <strong>Lähettänyt: {{message.username}} {{message.sent_at.strftime("%d.%m.%Y klo %H:%M:%S")}}</strong> <br>
    <div id="text_{{message.id}}" style="display:block"> 
    <p>{{message.content}}</p>
    {% if session.username == message.username or session.admin %}
        <form action="/deletemessage" method="POST">
            <input type="submit" value="Poista viesti">
            <button type="button" onclick="edit({{message.id}});">Muokkaa viestiä</button><br>
            <input type="hidden" name="message_id" value="{{message.id}}">
            <input type="hidden" name="thread_id" value="{{thread.id}}">    
            <input type="hidden" name="csrf_token" value="{{session.csrf_token}}">
        </form>
    {% endif %}
    </div>

    <div id="edit_{{message.id}}" style="display:none">
        <form action="/editmessage" method="POST">
            <textarea name="content" rows=5 cols=40>{{message.content}}</textarea><br>
            <input type="hidden" name="message_id" value="{{message.id}}">
            <input type="hidden" name="thread_id" value="{{thread.id}}">
            <input type="submit" value="Vahvista muutokset">
            <button type="button" onclick="cancel({{message.id}});">Peruuta</button>
            <input type="hidden" name="csrf_token" value="{{session.csrf_token}}">
        </form>
    </div>

    <hr>
{% endfor %}
<br>
{% if session.username %}
<form action="/createmessage" method="POST">
    <input type="text" name="content">
    <input type="submit" value="Lähetä viesti">
    <input type="hidden" name="thread_id" value="{{thread.id}}">    
    <input type="hidden" name="csrf_token" value="{{session.csrf_token}}">
</form>
{% endif %}
{% for message in get_flashed_messages() %}
<strong style="color:red">{{message}}</strong>
{% endfor %}

<script type="text/javascript">
    function edit(message_id) {
        document.getElementById("edit_" + message_id).style.display="block";
        document.getElementById("text_" + message_id).style.display="none";
    }
    function cancel(message_id) {
        document.getElementById("edit_" + message_id).style.display="none";
        document.getElementById("text_" + message_id).style.display="block";
    }
</script>