<title>Diskus</title>

{% if session.username %}
    <h1>Tervetuloa, {{session.username}}!</h1>
{% else %}
    <h1>Tervetuloa!</h1>
    <a href="/login">Kirjaudu sisään</a> tai <a href="/register">rekisteröidy</a>
{% endif %}

<a href="/search" style="right:1em; position:absolute">Hae viestejä</a>
<h3>Aiheet</h3>
{% for forum in forums %}
    <h4>
    {% if not forum.hide or session.admin or (session.allowed and forum.id in session.allowed) %}
        <hr>
        <a href="/forums/{{forum.id}}">{{forum.topic}}</a> {% if forum.hide %} (Piilotettu aihe) {% endif %} <br>
        Lankoja aiheessa: {{forum.threadcount}}<br>
        Viestejä aiheessa: {{forum.msgcount}} <br>
        {% if forum.lastmsg %}
            Viimeisin viesti: {{forum.lastmsg.strftime("%d.%m.%Y klo %H:%M:%S")}}
        {% endif %}
        {% if session.admin %}
            <form action="/deleteforum" method="POST">
                <input type="submit" value="Poista aihe">
                {% if forum.hide %}<button type="button" onclick="location.href='manage-rights?id={{forum.id}}'">Muokkaa pääsyoikeuksia</button>{% endif %}
                <input type="hidden" name="forum_id" value="{{forum.id}}">
                <input type="hidden" name="csrf_token" value="{{session.csrf_token}}">
            </form>
        {% endif %}
    {% endif %}
    </h4>
{% endfor %}
<hr>

{% if session.admin %}
<form action="/createforum" method="POST">
    <input type="text" name="topic" placeholder="Aihe">
    <input type="checkbox" id="hidden" name="hidden">
    <label for="hidden">Piilotettu</label> <br>
    <input type="submit" value="Tee uusi aihe">
    <input type="hidden" name="csrf_token" value="{{session.csrf_token}}">
</form>
{% endif %}
{% for message in get_flashed_messages() %}
<strong style="color:red">{{message}}</strong>
{% endfor %}

{% if session.username %}
    <br><br>
    <a href="/logout"> Kirjaudu ulos</a>

    <br>
    {% if session.admin %}
        <a href="/demote/">Muuta itsesi käyttäjäksi</a>
    {% else %}
        <a href="/promote/">Muuta itsesi ylläpitäjäksi</a>
    {% endif %}
{% endif %}
